# agilent4uhv.template
# Template database for the Agilent 4UHV Ion Pump Controller 
#     This version only scan the most important parameters,
# Pete Owens 4/6/2015
#
# substitutions:
# device  - device name
# port    - asyn port
# chan    - channel number
#
################################################################################
# Refresh the values of setup parameters
#
#
#Edited by S.Friederich:
#   $(P) Zone
#   $(R) Subzone
#   $(CH)
#
################################################################################
# idn
#

record (waveform, "$(P)$(R)idn_get") {
    field(DESC, "Get serial number of device")
    field(DTYP, "stream")
    field(INP, "@agilent_4UHV.proto get_serial $(PORT)")
    field(PINI, "YES")
}


################################################################################
# State
#

record(bo, "$(P)$(R)on_set") {
    field(DESC, "State")
    field(DTYP, "stream")
    field(OUT,  "@agilent_4UHV.proto set_state($(CH)) $(PORT)")
    field(ZNAM, "Off")
    field(ONAM, "On")
}

record(bi, "$(P)$(R)on_get") {
    field(DESC, "State")
    field(DTYP, "stream")
    field(INP,  "@agilent_4UHV.proto get_state($(CH)) $(PORT)")
    field(SCAN, "1 second")
    field(ZNAM, "Off")
    field(ONAM, "On")
}

################################################################################
# V target
# 3-7 kV
#

record(ao, "$(P)$(R)u_set") {
    field(DESC, "V target")
    field(DTYP, "stream")
    field(OUT,  "@agilent_4UHV.proto set_vtgt($(CH)) $(PORT)")
    field(EGU,  "kV")
    field(LOPR, "3")
    field(HOPR, "7")
    field(DRVL, "3")
    field(DRVH, "7")
    field(FLNK, "$(P)$(R)u_get")
}

################################################################################
# V measured
# 0-10000 V
#

record(ai, "$(P)$(R)u_get") {
    field(DESC, "V measured")
    field(DTYP, "stream")
    field(INP,  "@agilent_4UHV.proto get_volt($(CH)) $(PORT)")
    field(SCAN, "1 second")
    field(EGU,  "kV")
    field(PREC, "1")
    field(LINR, "LINEAR")
    field(ESLO, "0.001")
    field(LOPR, "0")
    field(HOPR, "10")
    field(LOW,  "0")
    field(HIGH, "10000")
    field(LOLO, "-1")
    field(HIHI, "10001")
    field(LSV,  "MINOR")
    field(HSV,  "MINOR")
    field(LLSV, "MAJOR")
    field(HHSV, "MAJOR")
}

################################################################################
# Temperature HV
# 0-200 C
#

record(longin, "$(P)$(R)t_get") {
    field(DESC, "Temperature HV")
    field(DTYP, "stream")
    field(INP,  "@agilent_4UHV.proto get_temp$(CH) $(PORT)")
    field(SCAN, "10 second")
    field(EGU,  "C")
    field(LOPR, "0")
    field(HOPR, "200")
    field(LOW,  "0")
    field(HIGH, "200")
    field(LOLO, "-1")
    field(HIHI, "201")
    field(LSV,  "MINOR")
    field(HSV,  "MINOR")
    field(LLSV, "MAJOR")
    field(HHSV, "MAJOR")
}

################################################################################
# I measured
# 1E-10-9E-1A
#

record(ai, "$(P)$(R)i_get_raw") {
    field(DESC, "I measured")
    field(DTYP, "stream")
    field(INP,  "@agilent_4UHV.proto get_curr($(CH)) $(PORT)")
    field(SCAN, "1 second")
    field(EGU,  "A")
    field(PREC, "10")
    field(FLNK, "$(P)$(R)i_get")
}

record (calc, "$(P)$(R)i_get")
{
    field(SCAN, "Passive")
    field(INPA, "$(P)$(R)i_get_raw")
    field(CALC, "A=0? 1e-10: A")
    field(EGU, "A")
    field(LOPR, "1e-10")
    field(HOPR, "1")
    field(HIGH, "1e-9")
    field(HIHI, "1e-7")
    field(HSV,  "MINOR")
    field(HHSV, "MAJOR")
}

################################################################################
# Pressure
#

record(ai, "$(P)$(R)p_get_raw") {
    field(DESC, "Pressure")
    field(DTYP, "stream")
    field(INP,  "@agilent_4UHV.proto get_press($(CH)) $(PORT)")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(PREC, "9")
    field(LOPR, "1e-11")
    field(HOPR, "1000")
    field(LOW,  "0")
    field(HIGH, "1")
    field(LOLO, "-0.1")
    field(HIHI, "1000")
#    field(LSV,  "MINOR")
    field(HSV,  "MINOR")
    field(LLSV, "MAJOR")
    field(HHSV, "MAJOR")
    field(FLNK, "$(P)$(R)p_get")
}

record(calc, "$(P)$(R)p_get")
{
        field(SCAN, "Passive")
        field(INPA, "$(P)$(R)p_get_raw")
        field(CALC, "A =0 ? 1e-11 : A")
        field(EGU, "mbar")
        field(LOPR, "1e-11")
        field(HOPR, "1000")
        field(PREC, 2)
}

################################################################################
# Error code
#

record(mbbiDirect, "$(P)$(R)error_get") {
    field(DESC, "Error code")
    field(DTYP, "stream")
    field(INP,  "@agilent_4UHV.proto get_error($(CH)) $(PORT)")
    field(SCAN, "1 second")
}
################################################################################

# Set point status (all channels)
#

record(waveform, "$(P)$(R)sp_all_get") {
    field(DESC, "Set point status of all channels")
    field(DTYP, "stream")
    field(INP,  "@agilent_4UHV.proto get_setptstatus $(PORT)")
    field(NELM, "4")
    field(FTVL, "USHORT")
    #field(PINI, "YES")
}

################################################################################

# Get interlock status (all channels; HV Interlock; Not the relais for set points!)
#

record(mbbi, "$(P)$(R)interlock_get") {
    field(DESC, "Set point status of all channels")
    field(DTYP, "stream")
    field(INP,  "@agilent_4UHV.proto get_interlock $(PORT)")
}

################################################################################
# I protect
# 1-100 mA
#

#record(longout, "$(P)$(R)IPROT_SP")
#{
#    field(DESC, "I protect")
#    field(DTYP, "stream")
#    field(OUT,  "@agilent_4UHV.proto set_iprot($(CH)) $(PORT)")
#    field(EGU,  "mA")
#    field(LOPR, "0")
#    field(HOPR, "100")
#    field(DRVL, "1")
#    field(DRVH, "100")
#    field(FLNK, "$(P)$(R)IPROT_RB")
#}
#
#record(longin, "$(P)$(R)IPROT_RB")
#{
#    field(DESC, "I protect")
#    field(DTYP, "stream")
#    field(INP,  "@agilent_4UHV.proto get_iprot($(CH)) $(PORT)")
##    field(SCAN, "10 second")
#    field(EGU,  "mA")
#    field(LOPR, "0")
#    field(HOPR, "100")
#    field(LOW,  "0")
#    field(HIGH, "101")
#    field(LOLO, "-1")
#    field(HIHI, "110")
#    field(LSV,  "MINOR")
#    field(HSV,  "MINOR")
#    field(LLSV, "MAJOR")
#    field(HHSV, "MAJOR")
#}
################################################################################
# Set point
#

################################################################################
# Temperature FAN
# 0-200 C
#
#record(longin, "$(P)$(R)TEMPFAN")
#{
#    field(DESC, "Temperature FAN")
#    field(DTYP, "stream")
#    field(INP,  "@agilent_4UHV.proto get_tempf $(PORT)")
#    field(SCAN, "10 second")
#    field(EGU,  "C")
#    field(LOPR, "0")
#    field(HOPR, "200")
#    field(LOW,  "0")
#    field(HIGH, "200")
#    field(LOLO, "-1")
#    field(HIHI, "201")
#    field(LSV,  "MINOR")
#    field(HSV,  "MINOR")
#    field(LLSV, "MAJOR")
#    field(HHSV, "MAJOR")
#}

